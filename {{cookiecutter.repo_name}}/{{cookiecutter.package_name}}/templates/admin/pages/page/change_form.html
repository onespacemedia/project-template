{% extends "admin/change_form.html" %}
{% load i18n admin_static admin_modify admin_urls %}

{% block extrahead %}
  {% url 'admin:jsi18n' as jsi18nurl %}
  <script type="text/javascript" src="{{ jsi18nurl|default:"../../../jsi18n/" }}"></script>

  {# Needed for sorting section pages #}
  <script type="text/javascript" src="{% static 'cms/js/sortable/sortables.min.js' %}"></script>

  {# Needed for fixing ForeignKeyRawIdFields  #}
  <script type="text/javascript" src="{% static 'cms/js/misc/index.js' %}"></script>

  {{ media }}

  <script>
    window.addEventListener('DOMContentLoaded', function (){
      window.jQuery('.js-LanguageSwitcher').change(function () {
        window.location.href = document.querySelector('.js-LanguageSwitcher').value;
      });
    })
  </script>

{% endblock %}

{% block extrastyle %}
  {{ block.super }}

  <style>
    .page-languages-header {
      margin-bottom: 4px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
      color: #6f7e95;
    }
    .page-languages {
      display: flex;
      margin-bottom: 16px;
    }
    .page-languages-new {
      display: inline-block;
      background-color: #d0dbe6;
      color: #6f7e95;
      border-radius: 4px;
      height: 32px;
      line-height: 32px;
      font-size: 12px;
      text-align: center;
      margin-left: 10px;
      padding: 0 20px;
      transition: background .3s, color .1s;
    }
    .page-languages-new:hover {
      background-color: #639af5;
      color: #fff;
    }
  </style>
{% endblock %}

{% block object-tools %}
  {% if change %}
    {% if not is_popup %}
      <ul class="object-tools initialized">
        {% block object-tools-items %}
          {% url opts|admin_urlname:'history' original.pk|admin_urlquote as history_url %}
          <li><a href="{% add_preserved_filters history_url %}" class="historylink"><i class="icon-time icon-alpha75"></i>{% trans "History" %}</a>
          </li>
          {% if has_absolute_url %}
            <li>
              <a href="{{ original.get_absolute_url }}?preview=1" class="viewsitelink"><i class="icon-eye-open icon-alpha75"></i>{% trans "View on site" %}</a>
            </li>
          {% endif %}

          {% if has_add_permission %}
            <li>
              <a href="../add/"><i class="icon-plus-sign icon-alpha75"></i>{% blocktrans with opts.verbose_name as name %}Add {{ name }}{% endblocktrans %}
              </a></li>
          {% endif %}

        {% endblock %}
      </ul>

      {% if language_pages and display_language_options %}
        <div class="page-languages-header">
          Page language
        </div>
        <div class="page-languages">
          <select class="js-LanguageSwitcher page-language-picker">
            {% for page in language_pages %}
              <option {% if original == page %}selected{% endif %} value="/admin/pages/page/{{ page.pk }}/change/#/tab/module_0/">
                {% if page.is_content_object == False %}
                  Default
                {% else %}
                  {{ page.country_group }}
                {% endif %}
              </option>
            {% endfor %}
          </select>
          <div>
            <a class="page-languages-new" href="/admin/pages/page/{% if original.is_content_object %}{{ original.owner.pk }}{% else %}{{ original.pk }}{% endif %}/duplicate">Add translation</a>
          </div>
        </div>
      {% endif %}

    {% endif %}
  {% endif %}
{% endblock %}

{% block footer %}
  {% if has_absolute_url %}
    <div class="submit-row sharing-links">
      <h3>Share this on:</h3>
      <input type="submit" value="Facebook" name="https://www.facebook.com/sharer.php?u={% if request.is_secure %}https{% else %}http{% endif %}%3A%2F%2F{{ request.META.HTTP_HOST }}{{ original.get_absolute_url|urlencode }}">

      <input type="submit" value="Twitter" name="https://twitter.com/share?url={% if request.is_secure %}https{% else %}http{% endif %}%3A%2F%2F{{ request.META.HTTP_HOST }}{{ original.get_absolute_url|urlencode }}&amp;text={{ original.title|urlencode }}">

      <input type="submit" value="LinkedIn" name="https://www.linkedin.com/shareArticle?url={% if request.is_secure %}https{% else %}http{% endif %}%3A%2F%2F{{ request.META.HTTP_HOST }}{{ original.get_absolute_url|urlencode }}&amp;title={{ original.title|urlencode }} ">
    </div>
    <script>
    jQuery('.sharing-links input').each(function() {
      var $ = jQuery;
      $(this).click(function(ev) {
        ev.preventDefault();
        var url = $(this).attr('name');
        window.open(url, '_blank', 'height=400,width=600,menubar=no,status=no,toolbar=no');
      })
    });
    </script>
    <style>
      .sharing-links {
        padding: 20px;
      }

      .sharing-links input {
        cursor: pointer;
      }
    </style>
  {% endif %}
{% endblock %}
