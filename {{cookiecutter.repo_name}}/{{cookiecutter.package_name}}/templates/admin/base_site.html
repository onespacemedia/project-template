{% extends "admin/base.html" %}
{% load static i18n %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block branding %}
  <h1 id="site-name">
    {{ settings.SITE_NAME }}
  </h1>
{% endblock %}

{% block extrastyle %}
  {{ block.super }}

  <style>
    @media (min-width: 960px) {
      .mce-tinymce {
        width: calc(100% - 170px) !important;
        margin-left: 170px !important;
      }
    }

    .related-widget-wrapper {
      display: inline-block;
    }

    .related-widget-wrapper .change-related,
    .related-widget-wrapper .delete-related {
      display: none;
    }

    /* Jet tweaks. */
    .sidebar-link,
    .sidebar-link:visited,
    .sidebar-link:hover {
      padding: 12px 12px 12px 24px;
    }
    .related-widget-wrapper {
      display: inline-block;
    }

    #branding h1,
    #branding h2 {
      font-size: 14px;
      line-height: 28px;
    }

    .sidebar-popup-section {
      position: unset;
    }

    @media screen and (min-width: 960px) {
      .sidebar-popup {
        background-color: unset;
        overflow-y: unset;
      }

      .sidebar-popup-section {
        position: absolute;
        right: 0;
        left: 0;

        background-color: #ecf2f6;
        border-top-right-radius: 4px;
        border-bottom-right-radius: 4px;
        box-shadow: rgba(0, 0, 0, 0.15) 4px 16px 16px;
        overflow: hidden;

      }

      .sidebar-popup-title,
      .sidebar-popup-search {
        display: none;
      }

      .sidebar-popup-container {
        background-color: unset !important;
      }
    }

    .sidebar-popup {
      top: unset;
      bottom: unset;
    }

    .sidebar-popup-list-item a:hover {
      background-color: #42cf77;
      color: #fff;

      cursor: pointer;
    }
  </style>
{% endblock %}

{% block extrahead %}
  <script type="text/javascript" src="{% static 'cms/js/misc/index.js' %}"></script>

  <script>
    window.cmsUrls = window.cmsUrls || {}
    window.cmsUrls.imageLibraryIframe = '{% url "admin:media_file_wysiwyg_list" %}';
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // appsList contains nodes with data atributes of the form: data-app-label="APP"
      var appsList = Array.from(document.querySelectorAll('.app-item'))

      // popupList contains nodes with classes of the form: sidebar-popup-section-APP
      var popupsList = document.querySelector('.sidebar-popup')

      if (popupsList) {
        // Nuke all event listeners on popupsList
        popupsList.innerHTML += ''
      }

      for (var i=appsList.length - 1; i>=0; i--) {
        var appName = appsList[i].dataset.appLabel
        var relatedPopup = popupsList.querySelector('.sidebar-popup-section-' + appName)
        appsList[i].addEventListener('mouseenter', sidebarHoverIn.bind(this, appsList[i], popupsList, relatedPopup))
      }

      function sidebarHoverIn (el, popupsList, popup) {
        popupsList.style.top = el.getBoundingClientRect().top + 'px'

        var popupsArray = Array.from(popupsList.querySelectorAll('.sidebar-popup-section'))
        for (var i=popupsArray.length - 1; i>=0; i--) {
          popupsArray[i].style.display = 'none'
        }
        popup.style.display = 'block'

        // for mobile, don't set this as Jet does something else with the sidebar for mobiles
        if (window.innerWidth > 960) {
          var sidebarContainer = document.querySelector('.sidebar-popup-container')
          sidebarContainer.style.display = 'block'
        }
      }
    })
  </script>

  {% include "admin/cms/scripts.html" %}

  {{ block.super }}
{% endblock %}

{% block nav-global %}
  <a href="https://documentation.onespacemedia.com/" target="_blank" class="sidebar-link icon">
    <span class="sidebar-link-label">
      <span class="sidebar-link-icon">
        <svg id="i-file" viewBox="0 0 32 32" width="18" height="18" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M6 2 L6 30 26 30 26 10 18 2 Z M18 2 L18 10 26 10" />
        </svg>
      </span>OSM documentation portal
    </span>
  </a>

  <a href="https://retainer.onespacemedia.com" target="_blank" class="sidebar-link icon">
    <span class="sidebar-link-label">
      <span class="sidebar-link-icon">
        <svg id="i-portfolio" viewBox="0 0 32 32" width="18" height="18" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
          <path d="M29 17 L29 28 3 28 3 17 M2 8 L30 8 30 16 C30 16 24 20 16 20 8 20 2 16 2 16 L2 8 Z M16 22 L16 18 M20 8 C20 8 20 4 16 4 12 4 12 8 12 8" />
        </svg>
      </span>OSM retainer portal
    </span>
  </a>
{% endblock %}
